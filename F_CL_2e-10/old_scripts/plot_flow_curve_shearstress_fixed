#!/usr/bin/python
import os
import numpy as np
import pandas as pd
import matplotlib as mpl
mpl.use('Agg')
import matplotlib.pyplot as plt


def get_nu_mean_std(path):
    db = pd.read_csv(path)
    nu = db[db.columns[4]][:].values
    return np.mean(nu), np.std(nu)

phivals = [40,45,50,54,55,56]
ydvals = [float(i) for i in range(10000)]
paths_temp = ["rhor1_phi{}_yd{}".format(i,j) for i in phivals for j in ydvals ]
paths = []
for i in paths_temp:
    if os.path.exists(i+"/result/nu_t.dat"):
        paths.append(i+"/result/nu_t.dat")
#print paths
plt.figure(dpi=300)
for phi in phivals:
    yd_list,nu_mean_list, nu_std_list = [],[],[]
    for yd in ydvals:
        path = "rhor1_phi{}_yd{}".format(phi,yd)+"/result/nu_t.dat"
        if os.path.exists(path):
            #print path
            nu_mean,nu_std = get_nu_mean_std(path)
            yd_list.append(yd)
            nu_mean_list.append(nu_mean)
            nu_std_list.append(nu_std)
    plt.errorbar(np.multiply(yd_list,nu_mean_list)*1.002e-3, nu_mean_list, yerr=nu_std_list, label="$\phi=${}".format(phi/100.0),fmt="o-",elinewidth=0.5,capthick=0.5,capsize=5,linewidth=3,)

plt.legend(loc="best")
plt.xlabel("shear stress $\sigma$ (Pa)")
plt.ylabel("relative viscosity $\eta_{r}$")
plt.xscale("log")
plt.yscale("log")
plt.savefig("flowcurve_shearstress_vs_nu_rel_errrorbars")
